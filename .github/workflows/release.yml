name: Publish Release

on:
  push:
    tags:
      - 'v*'   # run only when you push a version tag

jobs:
  release:
    runs-on: windows-latest
    permissions:
      contents: write

    steps:
      - name: Enable debug logging
        run: echo "ACTIONS_STEP_DEBUG=true" >> $GITHUB_ENV

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Package mod
        shell: pwsh
        run: |
          $workspaceRoot = "${{ github.workspace }}"
          $repoName      = "${{ github.event.repository.name }}"
          $zipPath       = Join-Path $workspaceRoot "$repoName.zip"

          Write-Host "DEBUG: workspaceRoot is $workspaceRoot"
          Write-Host "DEBUG: repoName is $repoName"
          Write-Host "DEBUG: zipPath is $zipPath"

          Compress-Archive -Path "$workspaceRoot\build\*" -DestinationPath $zipPath -Force
          Write-Host "Packaged $zipPath successfully!"

          "ZIP_PATH=$zipPath" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append

      - name: Echo ZIP_PATH
        run: echo "ZIP_PATH is ${{ env.ZIP_PATH }}"

      - name: Upload release asset
        uses: softprops/action-gh-release@v1
        with:
          # Use a glob so it matches any zip in the workspace
          files: '**/*.zip'